<%- include("../partials/header.ejs") %>
    <div id="kt_content_container" class="d-flex flex-column-fluid align-items-start container-xxl pb-5">
        <div class="content flex-row-fluid" id="kt_content">
            <div class="row g-5 g-xl-4">
                <div class="col-12">
                    <div class="card py-0 border-0">
                        <div class="card-header border-bottom-0">
                            <div class="card-title w-100">
                                <i class="fa fa-bell fs-2 text-danger me-5"></i>
                                <marquee class="w-100"><span class="text-danger fw-bold">Lưu ý: Việt nam đang bị đứt cáp quang. Sẻ có những nhà mạng xem phim sẽ cực kỳ lag, chậm thậm chí không xem được (đặc biệt vào buổi tối). Nên xem vào ban ngày nhé.</span></marquee>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="card bg-body border-0">
                        <div class="card-body p-0 border-0">
                            <div class="tv-player">
                                <iframe class="iframe-player rounded-top" src="/iframe/<%= info.slug %>/<%= info.episode %>" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                            </div>
                        </div>
                        <div class="card-footer px-3 py-3 border-0">
                            <div class="d-flex flex-stack">
                                <div class="align-content-start">
                                    <button class="btn btn-sm bg-light"><i class="fas fa-eye"></i><span><%- info.seen %></span></button>
                                </div>
                                <div class="align-content-end">
                                    <a class="btn btn-sm bg-light text-gray-800 text-hover-success text-active-success <%- info.liked %>" href="" id="bookmark">
                                        <i class="fas fa-bookmark" aria-hidden="true"></i>
                                        <span>Yêu Thích</span>
                                    </a>
                                    <a class="btn btn-sm bg-light text-gray-800 text-hover-success ms-2" href="">
                                        <i class="fas fa-bug" aria-hidden="true"></i>
                                        <span>Báo Lỗi</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fs-2x fw-bolder mt-4">
                        <div class="">
                            <%= info.title %>
                            <% if (info.episode_list.length > 1) { %>
                            <span class="svg-icon svg-icon-muted svg-icon-2 align-self-center me-0 ms-0">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12.6343 12.5657L8.45001 16.75C8.0358 17.1642 8.0358 17.8358 8.45001 18.25C8.86423 18.6642 9.5358 18.6642 9.95001 18.25L15.4929 12.7071C15.8834 12.3166 15.8834 11.6834 15.4929 11.2929L9.95001 5.75C9.5358 5.33579 8.86423 5.33579 8.45001 5.75C8.0358 6.16421 8.0358 6.83579 8.45001 7.25L12.6343 11.4343C12.9467 11.7467 12.9467 12.2533 12.6343 12.5657Z" fill="currentColor"/>
                                </svg>
                            </span> 
                            <span class="fs-2 text-gray-800 align-self-center">Tập <%= info.episode %></span>
                            <% } %>
                        </div>
                        <div class="fs-4 text-gray-700"><%= info.origin_name %></div>
                    </div>
                    <div class="info d-flex align-items-center text-gray-800 fs-6 my-3">
                        <span class="vip-info"></span>
                        <div class="broken-line"></div>
                        <span><%= info.time %></span>
                        <div class="broken-line"></div>
                        <span><%= info.year %></span>
                        <div class="broken-line"></div>
                        <div class="rating-label me-2 checked">
                            <i class="bi bi-star fs-2"></i>
                        </div>
                        <div class="rating-label me-2 checked">
                            <i class="bi bi-star fs-2"></i>
                        </div>
                        <div class="rating-label me-2 checked">
                            <i class="bi bi-star fs-2"></i>
                        </div>
                        <div class="rating-label me-2 checked">
                            <i class="bi bi-star fs-2"></i>
                        </div>
                        <div class="rating-label me-2 checked">
                            <i class="bi bi-star fs-2"></i>
                        </div>
                    </div>
                    <div class="tag my-4">
                        <% info.tags.forEach(function(item) { %>
                        <span class="badge bg-tags fs-7 p-2"><%= item %></span>
                        <% }); %>
                    </div>
                    <div class="more my-5">
                        <div class="accordion border-0" id="kt_info_more">
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header border-0" id="kt_more">
                                    <button class="accordion-button fs-4 fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#more" aria-expanded="true" aria-controls="more">Giới Thiệu</button>
                                </h2>
                                <div id="more" class="accordion-collapse border-0 collapse show" aria-labelledby="kt_more" data-bs-parent="#kt_info_more">
                                    <div class="accordion-body text-gray-800 fs-6">
                                        <%- info.description %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="episode my-5 d-lg-none d-block">
                        <div class="accordion border-0" id="kt_info_episode">
                            <div class="accordion-item border-0">
                                <h2 class="accordion-header border-0" id="kt_episode">
                                    <button class="accordion-button fs-4 fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#episode" aria-expanded="true" aria-controls="more">Danh Sách Tập Phim</button>
                                </h2>
                                <div id="episode" class="accordion-collapse border-0 collapse show" aria-labelledby="kt_episode" data-bs-parent="#kt_info_episode">
                                    <div class="accordion-body text-gray-800 fs-6">
                                        <div class="intl-episodes-list scroll h-200px">
                                            <% info.episode_list.forEach(function(item) { %>
                                            <div class="v-li movie">
                                                <a class="btn btn-sm bg-light w-100 h-lg-50px h-40px border-0 fw-bold" href="/phim/<%= info.slug %>/<%= item.episode %>">
                                                    <span class="text-episodes <% if (item.episode == info.episode) { %> active <% } %>"><%= item.name %></span>
                                                </a>
                                            </div>
                                            <% }); %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="separator my-7"></div>
                    <div class="col-lg-12">
                        <div class="fw-bolder fs-1">Đề xuất cho bạn</div>
                        <div class="row slider list-movie-player">
                            <% film_dexuat_player.forEach(function(item) { %>
                            <% var episode = JSON.parse(item.m3u8); %>
                            <div class="col-lg-1 item mb-5 p-3">
                                <a class="position-relative rounded" href="/phim/<%= item.slug %>/<%= episode[0].server_data[0].slug %>">
                                    <figure class="rounded">
                                        <img class="lazyLoad bgi-no-repeat bgi-position-center bgi-size-cover w-100 h-150px h-sm-175px h-md-275px h-lg-300px" data-src="<%= item.thumb_url; %>" src="/assets/icons/lazy-load-movie.gif">
                                    </figure>
                                    <div class="icon_overlay"></div>
                                    <div class="movie-post-episode"><%= item.episode_current %></div>
                                    <div class="movie-post-title-box">
                                        <div class="movie-post-title">
                                            <h2 class="text-gray-800"><%= item.title %></h2>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 d-none d-lg-block">
                    <div class="card card-flush bg-body border-0 mb-5">
                        <div class="card-header p-5 border-0">
                            <div class="fs-3 fw-bold">
                                <%= info.title %>
                                <br>
                                <span class="text-gray-500" style="font-size:11px;">Cập nhật lúc: <%- info.modified %></span>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="mb-5">
                                <div class="d-grid">
                                    <ul class="nav nav-tabs flex-nowrap text-nowrap" role="tablist">
                                        <li class="nav-item w-50" role="presentation">
                                            <a class="nav-link btn btn-active-light btn-color-gray-800 btn-active-color-primary fw-bold rounded-bottom-0 active" data-bs-toggle="tab" href="#kt_episode_list" aria-selected="true" role="tab">Danh Sách Tập</a>
                                        </li>
                                        <li class="nav-item w-50" role="presentation">
                                            <a class="nav-link btn btn-active-light btn-color-gray-800 btn-active-color-primary fw-bold rounded-bottom-0" data-bs-toggle="tab" href="#kt_comment" aria-selected="false" role="tab" tabindex="-1">Bình Luận</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="tab-content px-5" id="myTabContent">
                                <div class="tab-pane fade active show" id="kt_episode_list" role="tabpanel">
                                    <div class="intl-episodes-list scroll mb-5 500px">
                                        <ul class="nav nav-pills nav-pills-custom" role="episodelist">
                                            <% info.episode_list.forEach(function(item) { %>
                                            <li class="nav-item mb-3 me-3" role="presentation">
                                                <a class="nav-link btn btn-outline btn-flex btn-color-gray-800 btn-active-color-danger flex-column overflow-hidden tab-episode-list pb-2 <% if (item.episode == info.episode) { %>active<% } %>" href="/phim/<%= info.slug %>/<%= item.episode %>" role="tab">
                                                    <span class="fw-bold fs-6 lh-1"><%= item.name %></span>
                                                    <% if (item.episode == info.episode) { %><span class="bullet-custom position-absolute bottom-0 w-100 h-4px bg-success"></span><% } %>
                                                </a>
                                            </li>
                                            <% }); %>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="kt_comment" role="tabpanel">
                                    <span class="text-center text-gray-800 mb-5">Đang cập nhật...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--<div class="alert alert-dismissible bg-light-danger d-flex flex-center flex-column px-lg-10">
                        <button type="button" class="position-absolute top-0 end-0 m-2 btn btn-icon btn-icon-danger" data-bs-dismiss="alert">
                            <i class="bi bi-x fs-1 text-danger"></i>
                        </button>
                        <div class="text-center text-dark">
                            <h1 class="fs-3 fw-bold text-gray-800 mb-5">Khắc Cốt Ghi Tâm</h1>
                            <div class="separator separator-dashed border-danger opacity-25 mb-5"></div>
                            <div class="text-gray-800">Phim được lấy từ nhiều nguồn, chúng tôi không kiểm soát được tất cả quảng cáo trong luồng, bạn có thể vui vẻ tua phim để bỏ qua quảng cáo vì nó miễn phí ^^!</div>
                        </div>
                    </div>-->
                </div>
            </div>
        </div>
    </div>
<%- include("../partials/footer.ejs") %>
<script>
    $("#bookmark").on("click", (e) => {
        e.preventDefault();
        $.get("/ajax/bookmark/<%- info.slug %>", (data) => {
            Swal.fire({
                text: data.message,
                icon: data.type,
                buttonsStyling: true,
                confirmButtonText: data.buttontext,
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            }).then((result) => {
                if (data.reload == true) {
                    window.location.reload();
                }
            }); 


            if ($("#bookmark").hasClass("active")) {
                $("#bookmark").removeClass("active");
            } else {
                $("#bookmark").addClass("active");
            }
        });
    });
</script>